<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.madhouse.platform.premiummad.dao.AdvertiserMediaMapper" >
  <resultMap id="UnionResultMap" type="com.madhouse.platform.premiummad.entity.AdvertiserMediaUnion" >
    <!-- 包含DSP定义的广告主ID集合 -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="advertiser_id" property="advertiserId" jdbcType="INTEGER" />
    <result column="advertiser_key" property="advertiserKey" jdbcType="VARCHAR" />
    <result column="media_id" property="mediaId" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="TINYINT" />
    <result column="reason" property="reason" jdbcType="VARCHAR" />
    <result column="audited_user" property="auditedUser" jdbcType="INTEGER" />
    <result column="created_time" property="createdTime" jdbcType="TIMESTAMP" />
    <result column="audited_time" property="auditedTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Union_Column_List" >
    <!-- 包含DSP定义的广告主ID集合 -->
    adm.id, adm.advertiser_id, adm.media_id, adm.status, adm.reason, 
    adm.audited_user, adm.created_time, adm.audited_time, ad.advertiser_key
  </sql>
  <select id="selectAdvertiserMedias" resultMap="UnionResultMap">
    select 
    <include refid="Union_Column_List" />
    from mad_sys_advertiser_media adm
    left join mad_sys_advertiser ad on ad.id = adm.advertiser_id
	where ad.advertiser_key in
	   <foreach collection="advertiserKeys" item="advertiserKey" index="index"
           open="(" close=")" separator=",">
           #{advertiserKey,jdbcType=VARCHAR}
        </foreach>
        and ad.dsp_id = #{dspId,jdbcType=INTEGER}
  </select>
  <select id="selectByAdvertiserKeyAndMediaIds" resultMap="UnionResultMap" parameterType="com.madhouse.platform.premiummad.model.AdvertiserMediaModel">
    select 
    <include refid="Union_Column_List" />
    from mad_sys_advertiser_media adm
    left join mad_sys_advertiser ad on ad.id = adm.advertiser_id
	where ad.advertiser_key = #{id, jdbcType=VARCHAR} and adm.media_id in
	   <foreach collection="mediaId" item="item" index="index"
           open="(" close=")" separator=",">
           #{item,jdbcType=INTEGER}
        </foreach>
  </select>
  <insert id="insertByBatch" parameterType="java.util.List">
      insert into mad_sys_advertiser_media (advertiser_id, media_id, status, reason, 
      	audited_user, created_time, audited_time)
      values
      <foreach collection="list" item="item" index="index" separator=",">
        (#{item.advertiserId,jdbcType=INTEGER}, #{item.mediaId,jdbcType=INTEGER}, 
        #{item.status,jdbcType=TINYINT}, #{item.reason,jdbcType=VARCHAR}, 
        #{item.auditedUser,jdbcType=INTEGER}, #{item.createdTime,jdbcType=TIMESTAMP}, #{item.auditedTime,jdbcType=TIMESTAMP})
      </foreach>
  </insert>
  <update id="updateByBath" parameterType="java.util.List">
	<foreach collection="list" item="item" index="index" separator=";" open="" close="">
		  update mad_sys_advertiser_media
		    set advertiser_id = #{item.advertiserId,jdbcType=INTEGER},
		      media_id = #{item.mediaId,jdbcType=INTEGER},
		      status = #{item.status,jdbcType=TINYINT},
		      reason = #{item.reason,jdbcType=VARCHAR},
		      audited_user = #{item.auditedUser,jdbcType=INTEGER},
		      created_time = #{item.createdTime,jdbcType=TIMESTAMP},
		      audited_time = #{item.auditedTime,jdbcType=TIMESTAMP}
		    where id = #{item.id,jdbcType=INTEGER}
	</foreach>
  </update>
  <update id="updateForAudit" parameterType="com.madhouse.platform.premiummad.entity.AdvertiserMedia" >
    update mad_sys_advertiser_media
    <set >
      <if test="status != null" >
        status = #{status,jdbcType=TINYINT},
      </if>
      <if test="reason != null" >
        reason = #{reason,jdbcType=VARCHAR},
      </if>
      <if test="auditedUser != null" >
        audited_user = #{auditedUser,jdbcType=INTEGER},
      </if>
      <if test="auditedTime != null" >
        audited_time = #{auditedTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where advertiser_id = #{advertiserId,jdbcType=INTEGER}
      and media_id = #{mediaId,jdbcType=INTEGER}
  </update>
</mapper>