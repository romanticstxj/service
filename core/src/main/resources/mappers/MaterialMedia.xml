<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.madhouse.platform.premiummad.dao.MaterialMediaMapper" >
 <resultMap id="UnionResultMap" type="com.madhouse.platform.premiummad.entity.MaterialMediaUnion" >
 	 <!-- 包含DSP定义的素材ID集合 -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="material_id" property="materialId" jdbcType="INTEGER" />
    <result column="media_id" property="mediaId" jdbcType="INTEGER" />
    <result column="material_key" property="materialKey" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="TINYINT" />
    <result column="reason" property="reason" jdbcType="VARCHAR" />
    <result column="created_time" property="createdTime" jdbcType="TIMESTAMP" />
    <result column="audited_user" property="auditedUser" jdbcType="INTEGER" />
    <result column="audited_time" property="auditedTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Union_Column_List" >
  	<!-- 包含DSP定义的素材ID集合 -->
    mm.id, mm.material_id, mm.media_id, mm.status, mm.reason, 
    mm.created_time, mm.audited_user, mm.audited_time,m.material_key
  </sql>
  <select id="selectMaterialMedias" resultMap="UnionResultMap">
    select 
    <include refid="Union_Column_List" />
    from mad_sys_material_media mm
	left join mad_sys_material m on m.id = mm.material_id
	where m.material_key in
	   <foreach collection="materialKeys" item="materialKey" index="index"
           open="(" close=")" separator=",">
           #{materialKey,jdbcType=VARCHAR}
        </foreach>
  </select>
  <select id="selectByMaterialKeyAndMediaIds" resultMap="UnionResultMap" parameterType="com.madhouse.platform.premiummad.model.MaterialMediaModel">
    select 
    <include refid="Union_Column_List" />
    from mad_sys_material_media mm
	left join mad_sys_material m on m.id = mm.material_id
	where m.material_key = #{id, jdbcType=VARCHAR} and mm.media_id in
	   <foreach collection="mediaId" item="item" index="index"
           open="(" close=")" separator=",">
           #{item,jdbcType=INTEGER}
        </foreach>
  </select>
  <insert id="insertByBatch" parameterType="java.util.List">
      insert into mad_sys_material_media (material_id, media_id, status, reason, 
      	created_time, audited_user, audited_time)
      values
      <foreach collection="list" item="item" index="index" separator=",">
        (#{item.materialId,jdbcType=INTEGER}, #{item.mediaId,jdbcType=INTEGER}, 
         #{item.status,jdbcType=TINYINT}, #{item.reason,jdbcType=VARCHAR}, 
         #{item.createdTime,jdbcType=TIMESTAMP}, #{item.auditedUser,jdbcType=INTEGER}, #{item.auditedTime,jdbcType=TIMESTAMP})
      </foreach>
  </insert>
  <update id="updateByBath" parameterType="java.util.List">
	<foreach collection="list" item="item" index="index" separator=";" open="" close="">
		 update mad_sys_material_media
		    set material_id = #{item.materialId,jdbcType=INTEGER},
		      media_id = #{item.mediaId,jdbcType=INTEGER},
		      status = #{sitem.tatus,jdbcType=TINYINT},
		      reason = #{item.reason,jdbcType=VARCHAR},
		      created_time = #{item.createdTime,jdbcType=TIMESTAMP},
		      audited_user = #{item.auditedUser,jdbcType=INTEGER},
		      audited_time = #{item.auditedTime,jdbcType=TIMESTAMP}
		    where id = #{item.id,jdbcType=INTEGER}
	</foreach>
  </update>
  <update id="updateForAudit" parameterType="com.madhouse.platform.premiummad.entity.MaterialMedia" >
    update mad_sys_material_media
    <set >
      <if test="status != null" >
        status = #{status,jdbcType=TINYINT},
      </if>
      <if test="reason != null" >
        reason = #{reason,jdbcType=VARCHAR},
      </if>
      <if test="auditedUser != null" >
        audited_user = #{auditedUser,jdbcType=INTEGER},
      </if>
      <if test="auditedTime != null" >
        audited_time = #{auditedTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where material_id = #{materialId,jdbcType=INTEGER}
      and media_id = #{mediaId,jdbcType=INTEGER}
  </update>
</mapper>